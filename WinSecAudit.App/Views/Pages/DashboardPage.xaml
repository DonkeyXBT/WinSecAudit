<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="WinSecAudit.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WinSecAudit.Views.Pages"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    NavigationCacheMode="Required">

    <ScrollViewer>
        <StackPanel Padding="24" Spacing="24">
            <!-- Header -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Security Dashboard"
                               Style="{StaticResource PageHeaderStyle}"/>
                    <TextBlock x:Name="ComputerInfo"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button x:Name="QuickScanButton"
                            Style="{StaticResource AccentButtonStyle}"
                            Click="QuickScan_Click"
                            ToolTipService.ToolTip="Run a quick security scan of critical settings">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE916;" FontSize="16"/>
                            <TextBlock Text="Quick Scan"/>
                        </StackPanel>
                    </Button>
                    <Button Click="Refresh_Click"
                            ToolTipService.ToolTip="Refresh dashboard data">
                        <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Security Score Card -->
            <Border Style="{StaticResource CardStyle}" Padding="24">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0" Width="120" Height="120" Margin="0,0,24,0">
                        <ProgressRing x:Name="ScoreRing"
                                      IsIndeterminate="False"
                                      Value="0"
                                      Width="120" Height="120"
                                      Foreground="{StaticResource AccentBrush}"/>
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock x:Name="ScoreText"
                                       Text="--"
                                       FontSize="32"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"/>
                            <TextBlock x:Name="GradeText"
                                       Text="N/A"
                                       FontSize="16"
                                       HorizontalAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Grid>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="8">
                        <TextBlock Text="Security Score"
                                   Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <TextBlock x:Name="LastScanText"
                                   Text="No scans performed yet"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <StackPanel Orientation="Horizontal" Spacing="16" Margin="0,8,0,0">
                            <TextBlock x:Name="PassedText" Foreground="{StaticResource PassedBrush}"/>
                            <TextBlock x:Name="FailedText" Foreground="{StaticResource CriticalBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Summary Cards -->
            <TextBlock Text="Findings Summary" Style="{StaticResource SectionHeaderStyle}"/>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource MetricCardStyle}" Margin="0,0,8,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock x:Name="CriticalCount" Text="0"
                                   FontSize="36" FontWeight="Bold"
                                   Foreground="{StaticResource CriticalBrush}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Critical" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource MetricCardStyle}" Margin="4,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock x:Name="HighCount" Text="0"
                                   FontSize="36" FontWeight="Bold"
                                   Foreground="{StaticResource HighBrush}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="High" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" Style="{StaticResource MetricCardStyle}" Margin="4,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock x:Name="MediumCount" Text="0"
                                   FontSize="36" FontWeight="Bold"
                                   Foreground="{StaticResource MediumBrush}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Medium" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="3" Style="{StaticResource MetricCardStyle}" Margin="4,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock x:Name="LowCount" Text="0"
                                   FontSize="36" FontWeight="Bold"
                                   Foreground="{StaticResource LowBrush}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Low" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="4" Style="{StaticResource MetricCardStyle}" Margin="8,0,0,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock x:Name="InfoCount" Text="0"
                                   FontSize="36" FontWeight="Bold"
                                   Foreground="{StaticResource InfoBrush}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Info" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Critical Findings -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="Critical Findings" Style="{StaticResource SectionHeaderStyle}"/>
                <TextBlock Grid.Column="1" x:Name="CriticalFindingsCount"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </Grid>

            <Border Style="{StaticResource CardStyle}">
                <ListView x:Name="CriticalFindingsList"
                          SelectionMode="None"
                          ItemsSource="{x:Bind CriticalFindings}">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <FontIcon Grid.Column="0"
                                          Glyph="&#xE7BA;"
                                          Foreground="{StaticResource CriticalBrush}"
                                          Margin="0,0,12,0"/>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{Binding Check}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Description}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
